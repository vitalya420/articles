# Slow Loris під капотом та імплементуємо на Python

Дана стаття призначена для навчання принципам **Slow Loris атаки** та написання власного скрипта на Python. Варто зазначити, що цей тип атаки є **досить старим**, і сучасні системи можуть мати захист від неї. Однак цей матеріал створений виключно для **самонавчання та розуміння** принципів роботи цієї атаки. Slow Loris все ще може бути **ефективним** проти **погано сконфігурованих серверів**.

У **попередній статті** ми вже отримали схожу поведінку, експериментуючи з **вичерпанням воркерів Nginx**. Тепер розглянемо, як працює Slow Loris і як його реалізувати за допомогою Python.

## Визначення таймауту сервера

Щоб ефективно реалізувати **Slow Loris атаку**, спершу потрібно визначити таймаут сервера — час, протягом якого сервер тримає з’єднання відкритим, чекаючи дані. Це можна зробити за допомогою Linux утиліти `netcat` і `Wireshark` для аналізу трафіку.

### Крок 1: Визначення IP-адреси

Перетворимо доменне ім’я на IP-адресу за допомогою `nslookup`:
```
$ nslookup httpbin.org
Server:		127.0.0.53
Address:	127.0.0.53#53

Non-authoritative answer:
Name:	httpbin.org
Address: 3.230.67.98
Name:	httpbin.org
Address: 3.211.25.71
```

Як бачимо, у домену httpbin.org є дві IP-адреси. Це зв’язано з балансуванням навантаження. Для нашого експерименту зосередимося на 3.230.67.98.

### Крок 2: Аналіз трафіку у Wireshark

Відкриємо Wireshark і вкажемо фільтр для потрібної IP-адреси:
```
ip.addr eq 3.230.67.98
```

### Крок 3: Підключення через `netcat`

У терміналі підключимося до сервера без надсилання даних:

```
$ nc 3.230.67.98 443
```

Цим самим ми встановимо TCP-з’єднання, але не будемо передавати жодних даних.

### Крок 4: Визначення таймауту

У Wireshark побачимо наступне:
- Пакет [1] — ACK-пакет, який завершує TCP-рукостискання.
- Пакет [2] — FIN ACK-пакет, який завершує з’єднання.

Час між пакетом [1] та пакетом [2] можна побачити в колонці `Time`. Наприклад:

- Пакет [1]: 2.5 секунди
- Пакет [2]: 62.67 секунди

Різниця між ними — 60 секунд. Таким чином, таймаут сервера становить 60 секунд.

## Визначення Client Max Body Size (необов'язково)

Slow Loris можна комбінувати з іншими типами атак, наприклад, передавати велику кількість даних, які будуть утримуватися в оперативній пам’яті, або ж навантажувати сервер значними обсягами інформації. При цьому важливо враховувати пропускну здатність вашого інтернет-з’єднання, щоб встигнути передати дані до того, як сервер закриє з’єднання через таймаут.

Для прикладу, якщо ви відкриєте 65 000 з’єднань і кожне з них передаватиме 1 МБ даних, то: 65 000 × 1 МБ = 65 000 МБ (або **65 ГБ**). Оскільки таймаут сервера становить 60 секунд, потрібно розрахувати мінімальну швидкість передачі:
```
65 000 МБ / 60 секунд = 1083,33 МБ/сек
```

Потрібна швидкість для передачі даних — понад 1 ГБ/сек. Це величезний обсяг трафіку, і його досягти можна лише в ідеальних умовах з надпотужним інтернет-з’єднанням. Тому такий підхід ефективніший для атак усередині локальної мережі або з використанням кластеру ботнетів.

Однак **Slow Loris** це впершу в чергу про велику кількість з'єднаннь, то зосередимось на меншим по об'єму пакетах, як от `GET / HTTP/1.1\r\n\Host: httpbin.org\r\n\r\n` розмір якого 38 байт. Якщо ви відкриєте 65 000 з’єднань, загальний обсяг даних становитиме:

```
65 000 × 38 байт ≈ 2.47 МБ
```

Якщо сервер має таймаут 60 секунд, то необхідна швидкість для передачі всіх цих даних:
```
2.47 МБ / 60 секунд ≈ 41.2 КБ/сек
```
Таким чином, для підтримки такої атаки вам вистачить навіть повільного інтернет-з’єднання. Головне — не пропускна здатність, а правильний розподіл запитів і таймінги, щоб підтримувати з’єднання якомога довше, не викликаючи таймаутів.
